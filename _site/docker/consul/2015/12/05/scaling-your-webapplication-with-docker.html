<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Scaling your web application with Docker</title>
  <meta name="description" content="Imagine, the web application you developed has suddenly become quite popular and you need to scale up. In the old days this required installing another virtu...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.mansm.io/docker/consul/2015/12/05/scaling-your-webapplication-with-docker.html">
  <link rel="alternate" type="application/rss+xml" title="MansM tech babble" href="http://www.mansm.io/feed.xml">
  
  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">MansM tech babble</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Scaling your web application with Docker</h1>
    <p class="post-meta"><time datetime="2015-12-05T17:00:00+00:00" itemprop="datePublished">Dec 5, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><strong>Imagine, the web application you developed has suddenly become quite popular and you need to scale up. In the old days this required installing another virtual 
machine, which takes loads of time. Now, with the solution provided here, scaling up and down can be done in an instant. In this article I will show you how you 
can build an highly scalable environment for your web apps using Docker containers.</strong></p>

<div class="toc">
  <h4>Contents</h4>

<ul id="markdown-toc">
  <li><a href="#tooling" id="markdown-toc-tooling">Tooling</a></li>
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#how-to-start-docker" id="markdown-toc-how-to-start-docker">How to start Docker</a></li>
  <li><a href="#docker-containers" id="markdown-toc-docker-containers">Docker containers</a>    <ul>
      <li><a href="#consul-server" id="markdown-toc-consul-server">Consul server</a></li>
      <li><a href="#web-application" id="markdown-toc-web-application">Web application</a>        <ul>
          <li><a href="#dockerfile" id="markdown-toc-dockerfile">Dockerfile</a></li>
          <li><a href="#webjson" id="markdown-toc-webjson">web.json</a></li>
          <li><a href="#supervisordconf" id="markdown-toc-supervisordconf">supervisord.conf</a></li>
        </ul>
      </li>
      <li><a href="#load-balancer" id="markdown-toc-load-balancer">Load balancer</a>        <ul>
          <li><a href="#dockerfile-1" id="markdown-toc-dockerfile-1">Dockerfile</a></li>
          <li><a href="#haproxyctmpl" id="markdown-toc-haproxyctmpl">haproxy.ctmpl</a></li>
          <li><a href="#haproxyjson" id="markdown-toc-haproxyjson">haproxy.json</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#docker-compose" id="markdown-toc-docker-compose">Docker Compose</a>    <ul>
      <li><a href="#docker-composeyml" id="markdown-toc-docker-composeyml">docker-compose.yml</a></li>
    </ul>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="#sources" id="markdown-toc-sources">Sources</a></li>
</ul>

</div>

<p><a href="https://www.docker.com/">Docker</a> is an open source tool for building and running containers. Containers are an all-in-one package filled with the application and its dependencies.
The benefit of using containers is that it runs directly on the operating system, which saves you from a virtualization layer. Every container runs
separately, so your environment will be multi-tennant safe.</p>

<h2 id="tooling">Tooling</h2>
<ul>
  <li>Docker: In the current IT environment there is never enough speed, VM’s are slow and containers are hot. Docker is currently the most popular 
container software.</li>
  <li>Docker-compose: Tool for defining and launching multi-container applications.</li>
  <li>Haproxy: Open source load balancer for TCP and HTTP based services</li>
  <li>Consul: A tool for service discovery and configuration</li>
  <li>Apache with PHP: Just an example of a web application, but you can use any other web application type</li>
  <li>Supervisor: As we run next to the primary process a Consul application in the container we need something to launch them</li>
  <li>Virtualbox: Free hypervisor, supplied with Docker toolbox</li>
  <li>Git: Version control system for source code</li>
</ul>

<p>Of the list above you only need to install the Docker toolbox. You can find it at the Docker <a href="https://www.docker.com/docker-toolbox">website</a>. Make sure you 
have the docker “default” virtual machine created by opening Docker Kitematic (container monitor shipped with Docker toolbox) or use ‘docker-machine create’ to create it.</p>

<h2 id="overview">Overview</h2>
<p>In the image below you can see how the environment will be. As you can see I use three different parts of consul: the agent, the server and template. 
The agent tells the server it is online and which services the machine/container has available. Consul-template queries the server and replaces the 
configuration file of Haproxy which it also restarts. On shutting down a webserver the Consul agent notifies the server it is leaving and Consul-template 
will remove the server from the configuration file.</p>

<p><img src="/images/2015-12-05-scaling-your-webapplication-with-docker/overview.png" alt="Container overview" /></p>

<h2 id="how-to-start-docker">How to start Docker</h2>
<p><em>For Windows users:
I prefer to use Git Bash instead of Docker Quickstart Terminal because it allows easy pasting (shift+insert).</em></p>

<p>After you installed the Docker Toolbox, you’re almost ready to go. We only need to do the following steps:</p>

<p>Open a terminal/command line and create a new Docker-machine with the command:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker-machine create --driver <span class="s2">"virtualbox"</span> default</code></pre>
</figure>

<p>To prevent the other Docker tooling (like the Quickstart Terminal or Kitematic) creating a new Docker virtual machine, I’ve used the default name ‘default’.
On starting the terminal/command line you will have to direct to the location of the Docker-machine (when you forget: you will get an error about not be able to connect:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash"><span class="nb">eval</span> <span class="s2">"</span><span class="k">${</span><span class="nv">docker</span><span class="p">-machine env default)</span><span class="s2">"</span></code></pre>
</figure>

<h2 id="docker-containers">Docker containers</h2>
<p>Three different containers can be identified:</p>

<ul>
  <li>Consul server</li>
  <li>Load balancer with Consul-template</li>
  <li>Web service with Consul agent</li>
</ul>

<p>First of all, get the Git repository with the example code:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">git clone https://github.com/MansM/docker-scalingdemo.git</code></pre>
</figure>

<h3 id="consul-server">Consul server</h3>
<p>Change to the folder in your terminal or Windows command line where the Git repository is located. The Consul server is the ‘consul-server’ container made by Gliderlabs, to start it:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker run --rm --name consul -p 8500:8500 gliderlabs/consul-server -bootstrap-expect 1</code></pre>
</figure>

<p>To view the Consul server UI, you can browse to the docker_ip:8500, you can locate the IP with running the command:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker-machine ip default </code></pre>
</figure>

<p>If ‘default’ is not the correct Docker-machine, find the correct one with “docker-machine ls”.</p>

<p>You should now see something like:
<img src="/images/2015-12-05-scaling-your-webapplication-with-docker/consul-ui.png" alt="Consul UI" /></p>

<h3 id="web-application">Web application</h3>
<p>Now it’s time to add a webserver to the pool. First of all we need to build and run the Docker container:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker build -t apachephp apachephp
docker run  --rm --name web -p 8080:80 --link<span class="o">=</span><span class="s2">"consul"</span> apachephp</code></pre>
</figure>

<p>When you refresh the Consul UI screen, you will see the web server has been added. 
<img src="/images/2015-12-05-scaling-your-webapplication-with-docker/consul-ui-web.png" alt="Consul UI with webserver" /></p>

<p>In the command to start the web server I have used the option ‘link’. Setting this parameter Docker will link the mentioned container to the new container.</p>

<h4 id="dockerfile">Dockerfile</h4>
<p>The main item of any Docker container is the Dockerfile, this contains the building steps from which Docker builds the image.
In this case the base image we are using is PHP including Apache (line 1). On line 4 we install Supervisor and two
utilities to get the rest of the Dockerfile working. The Consul agent is downloaded and installed on line 9. The configuration for 
Supervisor and Consul is copied into the image on line 12 and 13. The last line is the command which will be executed on launching the container, 
in this case starting Supervisor to launch the other processes.</p>

<figure class="highlight">
  <pre><code class="language-docker" data-lang="docker"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre>FROM php:5.6-apache
ENV CONSUL_AGENT_VERSION=0.5.2

RUN apt-get update &amp;&amp; apt-get install -y supervisor wget unzip
RUN apt-get clean

RUN mkdir -p /var/log/supervisor
RUN mkdir -p /etc/consul.d 
RUN wget https://releases.hashicorp.com/consul/${CONSUL_AGENT_VERSION}/consul_${CONSUL_AGENT_VERSION}_linux_amd64.zip -O /tmp/consul-agent.zip &amp;&amp; unzip /tmp/consul-agent.zip &amp;&amp; mv consul /usr/local/bin

COPY src/ /var/www/html/
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
COPY web.json /etc/consul.d/web.json

CMD ["/usr/bin/supervisord"]<span class="w">
</span></pre></td></tr></tbody></table></code></pre>
</figure>

<h4 id="webjson">web.json</h4>
<p>This file is the configuration for the Consul agent. The service web is the selector which later will be used to identify the needed containers. Line 7 is quite important, it
makes the agent notify the server it is leaving when the container is stopped. This will save you from deregistering every stopped node in the Consul UI.</p>

<figure class="highlight">
  <pre><code class="language-json" data-lang="json"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nt">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"web"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"php"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"leave_on_terminate"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre>
</figure>

<h4 id="supervisordconf">supervisord.conf</h4>
<p>In the configuration file for Supervisor we mention that Supervisor should not be started as a daemon. The output will now be shown directly instead of being written to 
log files (and retrievable with “docker logs”).</p>

<figure class="highlight">
  <pre><code class="language-ini" data-lang="ini"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="nn">[supervisord]</span>
<span class="py">nodaemon</span><span class="p">=</span><span class="s">true</span>

<span class="nn">[program:apache]</span>
<span class="py">command</span><span class="p">=</span><span class="s">/usr/local/bin/apache2-foreground</span>

<span class="nn">[program:consulagent]</span>
<span class="py">command</span><span class="p">=</span><span class="s">consul agent -data-dir=/tmp/consul -join consul -config-dir /etc/consul.d</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="load-balancer">Load balancer</h3>
<p>The final container in the setup is the load balancer. You can start it with the following commands:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker build -t loadbalancer haproxy
docker run --rm -p 80:80 -p 9000:9000 --link<span class="o">=</span><span class="s2">"consul"</span> --link<span class="o">=</span><span class="s2">"web"</span> --name loadbalancer loadbalancer</code></pre>
</figure>

<p>The load balancer exists of two main components: Consul-template and Haproxy. I have chosen Haproxy in this setup so I can switch to non-HTTP backends as well.
In your browser go to docker_ip:9000/haproxy_stats (User/Pass: admin) to see the statistics page of Haproxy, which shows a single backend webserver.
<img src="/images/2015-12-05-scaling-your-webapplication-with-docker/haproxy.png" alt="Haproxy" /></p>

<h4 id="dockerfile-1">Dockerfile</h4>
<p>The Dockerfile of the load balancer consists of installing the software (line 5 &amp; 6) and copying configuration files into the image (line 9 &amp; 10).</p>

<figure class="highlight">
  <pre><code class="language-docker" data-lang="docker"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>FROM debian:latest
MAINTAINER Mans Matulewicz
ENV CONSUL_TEMPLATE_VERSION=0.10.0

RUN apt-get update &amp;&amp; apt-get install -y haproxy wget unzip
RUN ( wget --no-check-certificate https://github.com/hashicorp/consul-template/releases/download/v${CONSUL_TEMPLATE_VERSION}/consul-template_${CONSUL_TEMPLATE_VERSION}_linux_amd64.tar.gz -O /tmp/consul_template.tar.gz &amp;&amp; gunzip /tmp/consul_template.tar.gz &amp;&amp; cd /tmp &amp;&amp; tar xf /tmp/consul_template.tar &amp;&amp; cd /tmp/consul-template* &amp;&amp; mv consul-template /usr/bin &amp;&amp; rm -rf /tmp/* )
RUN apt-get clean

COPY haproxy.ctmpl /etc/haproxy.ctmpl
COPY haproxy.json /etc/haproxy.json

EXPOSE 80/tcp 9000/tcp
CMD ["consul-template", "-config=/etc/haproxy.json", "-consul=consul:8500"]<span class="w">
</span></pre></td></tr></tbody></table></code></pre>
</figure>

<h4 id="haproxyctmpl">haproxy.ctmpl</h4>
<p>Below is only a part of the Haproxy configuration file, the part that is modified by Consul-template. At line 7 the loop starts for every node that delivers the service web 
and it will create a line for every available server. Usually the word ‘check’ is placed at the end of every server-line to make Haproxy check for the availability of the server, 
however this is not necessary in this setup.</p>

<figure class="highlight">
  <pre><code class="language-nginx" data-lang="nginx"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="k">backend</span> <span class="s">nodes</span>
    <span class="s">mode</span> <span class="s">http</span>
    <span class="s">option</span> <span class="s">forwardfor</span>
    <span class="s">http-request</span> <span class="s">set-header</span> <span class="s">X-Forwarded-Port</span> <span class="s">%[dst_port]</span>
    <span class="s">http-request</span> <span class="s">add-header</span> <span class="s">X-Forwarded-Proto</span> <span class="s">https</span> <span class="s">if</span> <span class="p">{</span> <span class="kn">ssl_fc</span> <span class="err">}</span>
    <span class="s">option</span> <span class="s">httpchk</span> <span class="s">HEAD</span> <span class="n">/</span> <span class="s">HTTP/1.1</span><span class="err">\</span><span class="s">r</span><span class="err">\</span><span class="s">nHost:localhost</span>
    <span class="s">balance</span> <span class="s">roundrobin</span> <span class="p">{</span><span class="err">{</span><span class="kn">range</span> <span class="s">service</span> <span class="s">"web"</span><span class="err">}}</span>
    <span class="s">server</span> <span class="p">{</span><span class="err">{</span><span class="kn">.Node</span><span class="err">}}</span> <span class="p">{</span><span class="err">{</span><span class="kn">.Address</span><span class="err">}}</span><span class="p">:{</span><span class="err">{</span><span class="kn">.Port</span><span class="err">}}</span><span class="p">{</span><span class="err">{</span><span class="kn">end</span><span class="err">}}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre>
</figure>

<h4 id="haproxyjson">haproxy.json</h4>
<p>This is the configuration file for Consul-template. Using the source template file, it will generate the destination configuration file and will invoke Haproxy with the newly created
configuration file.</p>

<figure class="highlight">
  <pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nx">template</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"/etc/haproxy.ctmpl"</span>
  <span class="nx">destination</span> <span class="o">=</span> <span class="s2">"/etc/haproxy/haproxy.cfg"</span>
  <span class="nx">command</span> <span class="o">=</span> <span class="s2">"haproxy -f /etc/haproxy/haproxy.cfg -sf $(pidof haproxy) &amp;"</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre>
</figure>

<p>With the information above I have shown you how Docker works and how you can manually spin up multiple containers to build a Docker environment. In the next part I will show you
how you can simplify this and finally we get to scaling.</p>

<h2 id="docker-compose">Docker Compose</h2>
<p>Until now we have started all the containers one by one, but there is a more easy way to do it. We will using Compose, which is shipped with the Docker Toolbox. 
Before we can use it, we have to make sure all the manually started containers are gone, to prevents conflicts with ports. Below you can see the running containers:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">Manss-MacBook-Air:~ Mans<span class="nv">$ </span>docker ps
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                                                                NAMES
c475f80693b9        loadbalancer               <span class="s2">"consul-template -con"</span>   3 seconds ago       Up 3 seconds        0.0.0.0:80-&gt;80/tcp, 0.0.0.0:9000-&gt;9000/tcp                                           loadbalancer
ffd06220716f        apachephp                  <span class="s2">"/usr/bin/supervisord"</span>   17 seconds ago      Up 17 seconds       0.0.0.0:8080-&gt;80/tcp                                                                 web
16df4e7a5e64        gliderlabs/consul-server   <span class="s2">"/bin/consul agent -s"</span>   29 seconds ago      Up 28 seconds       8300-8302/tcp, 8400/tcp, 8301-8302/udp, 8600/tcp, 8600/udp, 0.0.0.0:8500-&gt;8500/tcp   consul</code></pre>
</figure>

<p>To stop them use the following command:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker stop loadbalancer web consul</code></pre>
</figure>

<p>To start all the containers of this project, use the command:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">docker-compose up</code></pre>
</figure>

<p>It will start all the containers and show the logging output in the terminal/command line.</p>

<p>Now it’s time for the stuff its all about: scaling! To increase the amount of web servers to 5, you just have to give this command:</p>

<figure class="highlight">
  <pre><code class="language-javascript" data-lang="javascript"><span class="nx">Manss</span><span class="o">-</span><span class="nx">MacBook</span><span class="o">-</span><span class="nx">Air</span><span class="err">:</span><span class="nx">scalingdemo</span> <span class="nx">Mans$</span> <span class="nx">docker</span><span class="o">-</span><span class="nx">compose</span> <span class="nx">scale</span> <span class="nx">web</span><span class="o">=</span><span class="mi">5</span>
<span class="nx">Creating</span> <span class="nx">and</span> <span class="nx">starting</span> <span class="mi">2</span> <span class="p">...</span> <span class="nx">done</span>
<span class="nx">Creating</span> <span class="nx">and</span> <span class="nx">starting</span> <span class="mi">3</span> <span class="p">...</span> <span class="nx">done</span>
<span class="nx">Creating</span> <span class="nx">and</span> <span class="nx">starting</span> <span class="mi">4</span> <span class="p">...</span> <span class="nx">done</span>
<span class="nx">Creating</span> <span class="nx">and</span> <span class="nx">starting</span> <span class="mi">5</span> <span class="p">...</span> <span class="nx">done</span></code></pre>
</figure>

<p>Within a couple of seconds you are now running your web application on 5 webservers: 
<img src="/images/2015-12-05-scaling-your-webapplication-with-docker/consul-ui-upscaled.png" alt="Consul UI upscaled" />
<img src="/images/2015-12-05-scaling-your-webapplication-with-docker/haproxy-upscaled.png" alt="Haproxy upscaled" /></p>

<h3 id="docker-composeyml">docker-compose.yml</h3>
<p>All the magic of Compose is configured in the docker-compose.yml listed below. In essence it is just listing all the containers and the runtime 
parameters.</p>

<figure class="highlight">
  <pre><code class="language-javascript" data-lang="javascript"><span class="nx">consul</span><span class="err">:</span>
  <span class="nl">image</span><span class="p">:</span> <span class="nx">gliderlabs</span><span class="o">/</span><span class="nx">consul</span><span class="o">-</span><span class="nx">server</span>
  <span class="nl">command</span><span class="p">:</span> <span class="o">-</span><span class="nx">bootstrap</span><span class="o">-</span><span class="nx">expect</span> <span class="mi">1</span>
  <span class="nl">ports</span><span class="p">:</span>
   <span class="o">-</span> <span class="s2">"8500:8500"</span>
<span class="nl">loadbalancer</span><span class="p">:</span>
  <span class="nl">build</span><span class="p">:</span> <span class="nx">haproxy</span>
  <span class="nl">ports</span><span class="p">:</span>
   <span class="o">-</span> <span class="s2">"80:80"</span>
   <span class="o">-</span> <span class="s2">"9000:9000"</span>
  <span class="nl">links</span><span class="p">:</span>
   <span class="o">-</span> <span class="nx">web</span>
   <span class="o">-</span> <span class="nx">consul</span>
<span class="nl">web</span><span class="p">:</span>
  <span class="nl">build</span><span class="p">:</span> <span class="nx">apachephp</span>
  <span class="nl">links</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">consul</span></code></pre>
</figure>

<h2 id="conclusion">Conclusion</h2>
<p>Creating an highly scalable environment is not hard, as this blogpost will have shown you. It is usable for containers as well for virtual machines (if you really want to).
In a later post I will add Docker swarm to the mix and extend the functionality over multiple (Docker-)machines.</p>

<h2 id="sources">Sources</h2>

<ul>
  <li>http://sirile.github.io/2015/05/18/using-haproxy-and-consul-for-dynamic-service-discovery-on-docker.html</li>
  <li>http://technologyconversations.com/2015/07/02/scaling-to-infinity-with-docker-swarm-Docker-compose-and-consul-part-14-a-taste-of-what-is-to-come/</li>
</ul>

  </div>

</article>

        
  <link rel="stylesheet" href="/res/css/comments.css">

  <div id="comments">
    <h2>Comments</h2>
    <div id="header">
      Want to leave a comment? Visit <a href="https://github.com/MansM/mansm.github.io/issues/1"> this post's issue page on GitHub</a> (you'll need a GitHub account).
    </div>
  </div>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <script type="text/javascript" src="http://datejs.googlecode.com/svn/trunk/build/date-en-US.js"></script>

  <script type="text/javascript">
    function loadComments(data) {
      for (var i=0; i<data.length; i++) {
        var cuser = data[i].user.login;
        var cuserlink = "https://www.github.com/" + data[i].user.login;
        var clink = "https://github.com/MansM/mansm.github.io/issues/1#issuecomment-" + data[i].url.substring(data[i].url.lastIndexOf("/")+1);
        var cbody = data[i].body_html;
        var cavatarlink = data[i].user.avatar_url;
        var cdate = Date.parse(data[i].created_at).toString("yyyy-MM-dd HH:mm:ss");
        $("#comments").append("<div class='comment'><div class='commentheader'><div class='commentgravatar'>" + '<img src="' + cavatarlink + '" alt="" width="20" height="20">' + "</div><a class='commentuser' href=\""+ cuserlink + "\">" + cuser + "</a><a class='commentdate' href=\"" + clink + "\">" + cdate + "</a></div><div class='commentbody'>" + cbody + "</div></div>");
      }
    }
    $.ajax("https://api.github.com/repos/MansM/mansm.github.io/issues/1/comments?per_page=100", {
      headers: {Accept: "application/vnd.github.full+json"},
      dataType: "json",
      success: function(msg){
        loadComments(msg);
     }
    });
  </script>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">MansM tech babble</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>MansM tech babble</li>
          <li><a href="mailto:mans@mansm.io">mans@mansm.io</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/MansM"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">MansM</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/Mans_M"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">Mans_M</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>My journey through technology
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
